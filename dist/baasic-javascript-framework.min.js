!function(e,t,n,i){function r(e,t){for(var n in t)e[n]=t[n];return e}var a=e.MonoSoftware||(e.MonoSoftware={}),o=n!==i?function(e,t,i){n(t).on(e,i)}:function(e,t,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n},u=n!==i?function(e,t,i){var a=r(n.Event(t),i);n(e).trigger(a)}:function(e,n,i){var a;return CustomEvent&&"function"==typeof CustomEvent?(a=r(new CustomEvent(n)),void e.dispatchEvent(a)):t.createEvent?(a=t.createEvent("CustomEvent"),a.initEvent(n,!0,!0),i&&r(a,i),void(e.dispatchEvent?e.dispatchEvent(a):t.dispatchEvent(a))):(a=t.createEventObject(),a.eventType=n,i&&r(a,i),void e.fireEvent("on"+a.eventType,a))};!function(n){!function(n){function a(e){localStorage.removeItem(f),localStorage.setItem(f,JSON.stringify(e))}function s(e,t){return new g(e,t)}function c(e){u(t,"tokenExpired",{app:e}),a({type:p.tokenExpired})}function g(n,s){function g(e){if(e&&null!==e&&e.expireTime){var t=e.expireTime-(new Date).getTime();if(t>0)return setTimeout(function(){c(h)},t)}return null}function v(e){if(clearTimeout(k),e!==i&&null!==e){if(!e.expireTime){var t=e.expires_in,n=e.sliding_window;t?e.expireTime=(new Date).getTime()+1e3*t:n&&(e.expireTime=(new Date).getTime()+1e3*n)}k=g(e)}}var d="baasic-user-info-"+n,m="baasic-auth-token-"+n,E={useSSL:!1,defaultLanguage:"en",apiRootUrl:"api.baasic.com",apiVersion:"v1",storeToken:function(e){e===i||null===e?localStorage.removeItem(m):localStorage.setItem(m,JSON.stringify(e))},readToken:function(){return JSON.parse(localStorage.getItem(m))},storeUserInfo:function(e){e===i||null===e?localStorage.removeItem(d):localStorage.setItem(d,JSON.stringify(e))},readUserInfo:function(){return JSON.parse(localStorage.getItem(d))}},h=this;r(E,s);var T=E.useSSL?"https":"http://"+E.apiRootUrl+"/"+E.apiVersion+"/"+n+"/",S=E.readToken(),k=null,w={isAuthenticated:function(){var e=h.getAccessToken();return e!==i&&null!==e&&(e.expireTime===i||null===e.expireTime||e.expireTime-(new Date).getTime()>0)}};S&&(k=g(S)),o("storage",e,function(e){if(e=e||event,e.originalEvent&&(e=e.originalEvent),e.key===f){var n=e.newValue;if(n&&""!==n){var i=JSON.parse(n);switch(i.type){case p.userChanged:u(t,"userChange",{user:h.getUser(),app:h});break;case p.tokenExpired:v(null),u(t,"tokenExpired",{app:h})}}}}),this.getApiKey=function(){return n},this.getApiUrl=function(){return T},this.getAccessToken=function(){return E.readToken()},this.updateAccessToken=function(e){v(e),E.storeToken(e),(e===i||null===e)&&c(h)},this.getUser=function(){var e=E.readUserInfo();return e?w.user=e:delete w.user,w},this.setUser=function(e){E.storeUserInfo(e),a({type:p.userChanged})},this.getDefaultLanguage=function(){return E.defaultLanguage},this.getCurrentLanguage=function(){return E.language?E.language:l?l:h.getDefaultLanguage()}}var l=navigator.language||navigator.userLanguage,f="baasic-message-bus",p={tokenExpired:"tokenExpired",userChanged:"userChanged"};n.init=s}(n.Application||(n.Application={}))}(a.Baasic||(a.Baasic={}))}(window,document,window.jQuery);