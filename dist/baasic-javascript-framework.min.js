!function(e,t,n,i){function a(e,t){for(var n in t)e[n]=t[n];return e}var r=e.MonoSoftware||(e.MonoSoftware={}),o=n!==i?function(e,t,i){n(t).on(e,i)}:function(e,t,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n},u=n!==i?function(e,t,i){var r=a(n.Event(t),i);n(e).trigger(r)}:function(e,n,i){var r;return CustomEvent&&"function"==typeof CustomEvent?(r=a(new CustomEvent(n)),void e.dispatchEvent(r)):t.createEvent?(r=t.createEvent("CustomEvent"),r.initEvent(n,!0,!0),i&&a(r,i),void(e.dispatchEvent?e.dispatchEvent(r):t.dispatchEvent(r))):(r=t.createEventObject(),r.eventType=n,i&&a(r,i),void e.fireEvent("on"+r.eventType,r))};!function(n){!function(n){function r(e){localStorage.removeItem(f),localStorage.setItem(f,JSON.stringify(e))}function s(e,t){return new g(e,t)}function c(e){u(t,"tokenExpired",{app:e}),r({type:p.tokenExpired})}function g(n,s){function g(e){if(e&&null!=e&&e.expireTime){var t=e.expireTime-(new Date).getTime();if(t>0)return setTimeout(function(){c(h)},t)}return null}function v(e){clearTimeout(k),e!==i&&null!==e&&(e.expireTime||(e.expires_in?e.expireTime=(new Date).getTime()+1e3*e.expires_in:e.sliding_window&&(e.expireTime=(new Date).getTime()+1e3*e.sliding_window)),k=g(e))}var d="baasic-user-info-"+n,m="baasic-auth-token-"+n,E={useSSL:!1,defaultLanguage:"en",apiRootUrl:"api.baasic.com",apiVersion:"v1",storeToken:function(e){e===i||null===e?localStorage.removeItem(m):localStorage.setItem(m,JSON.stringify(e))},readToken:function(){return JSON.parse(localStorage.getItem(m))},storeUserInfo:function(e){e===i||null===e?localStorage.removeItem(d):localStorage.setItem(d,JSON.stringify(e))},readUserInfo:function(){return JSON.parse(localStorage.getItem(d))}},h=this;a(E,s);var T=E.useSSL?"https":"http://"+E.apiRootUrl+"/"+E.apiVersion+"/"+n+"/",S=E.readToken(),k=null,w={isAuthenticated:function(){var e=h.get_accessToken();return e!==i&&null!==e&&(e.expireTime===i||null===e.expireTime||e.expireTime-(new Date).getTime()>0)}};S&&(k=g(S)),o("storage",e,function(e){if(e=e||event,e.originalEvent&&(e=e.originalEvent),e.key===f){var n=e.newValue;if(n&&""!==n){var i=JSON.parse(n);switch(i.type){case p.userChanged:u(t,"userChange",{user:h.get_user(),app:h});break;case p.tokenExpired:v(null),u(t,"tokenExpired",{app:h})}}}}),this.get_apiKey=function(){return n},this.get_apiUrl=function(){return T},this.get_accessToken=function(){return E.readToken()},this.update_accessToken=function(e){v(e),E.storeToken(e),(e===i||null===e)&&c(h)},this.get_user=function(){var e=E.readUserInfo();return e?w.user=e:delete w.user,w},this.set_user=function(e){E.storeUserInfo(e),r({type:p.userChanged})},this.get_currentLanguage=function(){return E.language?E.language:l?l:get_defaultLanguage()},this.get_defaultLanguage=function(){return E.defaultLanguage}}var l=navigator.language||navigator.userLanguage,f="baasic-message-bus",p={tokenExpired:"tokenExpired",userChanged:"userChanged"};n.init=s}(n.Application||(n.Application={}))}(r.Baasic||(r.Baasic={}))}(window,document,jQuery);