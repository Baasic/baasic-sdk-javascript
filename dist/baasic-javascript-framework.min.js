!function(e,n,t,i){function a(e,n){for(var t in n)e[t]=n[t];return e}var r=e.MonoSoftware||(e.MonoSoftware={}),o=t!==i?function(e,n,i){t(n).on(e,i)}:function(e,n,t){n.addEventListener?n.addEventListener(e,t,!1):n.attachEvent?n.attachEvent("on"+e,t):n["on"+e]=t},u=t!==i?function(e,n,i){var r=a(t.Event(n),i);t(e).trigger(r)}:function(e,t,i){var r;return CustomEvent&&"function"==typeof CustomEvent?(r=a(new CustomEvent(t)),void e.dispatchEvent(r)):n.createEvent?(r=n.createEvent("CustomEvent"),r.initEvent(t,!0,!0),i&&a(r,i),void(e.dispatchEvent?e.dispatchEvent(r):n.dispatchEvent(r))):(r=n.createEventObject(),r.eventType=t,i&&a(r,i),void e.fireEvent("on"+r.eventType,r))};!function(t){!function(t){function r(e){localStorage.setItem(f,JSON.stringify(e))}function s(e,n){return new g(e,n)}function c(e){u(n,"tokenExpired",{app:e}),r({type:p.tokenExpired})}function g(t,s){function g(e){if(e&&null!=e&&e.expireTime){var n=e.expireTime-(new Date).getTime();if(n>0)return setTimeout(function(){c(h)},n)}return null}function v(e){clearTimeout(k),e!==i&&null!==e&&(e.expireTime||(e.expires_in?e.expireTime=(new Date).getTime()+1e3*e.expires_in:e.sliding_window&&(e.expireTime=(new Date).getTime()+1e3*e.sliding_window)),k=g(e))}var d="baasic-user-info-"+t,m="baasic-auth-token-"+t,E={useSSL:!1,defaultLanguage:"en",apiRootUrl:"api.baasic.com",apiVersion:"v1",storeToken:function(e){e===i||null===e?localStorage.removeItem(m):localStorage.setItem(m,JSON.stringify(e))},readToken:function(){return JSON.parse(localStorage.getItem(m))},storeUserInfo:function(e){e===i||null===e?localStorage.removeItem(d):localStorage.setItem(d,JSON.stringify(e))},readUserInfo:function(){return JSON.parse(localStorage.getItem(d))}},h=this;a(E,s);var T=E.useSSL?"https":"http://"+E.apiRootUrl+"/"+E.apiVersion+"/"+t+"/",S=E.readToken(),k=null,w={isAuthenticated:function(){var e=h.get_accessToken();return e!==i&&null!==e&&(e.expireTime===i||null===e.expireTime||e.expireTime-(new Date).getTime()>0)}};S&&(k=g(S)),o("storage",e,function(e){if(e=e||event,e.originalEvent&&(e=e.originalEvent),e.key===f){var t=e.newValue;if(t&&""!==t){var i=JSON.parse(t);switch(i.type){case p.userChanged:u(n,"userChange",{user:h.get_user(),app:h});break;case p.tokenExpired:v(null),u(n,"tokenExpired",{app:h})}}}}),this.get_apiKey=function(){return t},this.get_apiUrl=function(){return T},this.get_accessToken=function(){return E.readToken()},this.update_accessToken=function(e){v(e),E.storeToken(e),(e===i||null===e)&&c(h)},this.get_user=function(){var e=E.readUserInfo();return e?w.user=e:delete w.user,w},this.set_user=function(e){E.storeUserInfo(e),r({type:p.userChanged})},this.get_currentLanguage=function(){return E.language?E.language:l?l:get_defaultLanguage()},this.get_defaultLanguage=function(){return E.defaultLanguage}}var l=navigator.language||navigator.userLanguage,f="baasic-message-bus",p={tokenExpired:"tokenExpired",userChanged:"userChanged"};t.init=s}(t.Application||(t.Application={}))}(r.Baasic||(r.Baasic={}))}(window,document,jQuery);